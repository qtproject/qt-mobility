<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- qversitcontactexporter.cpp -->
  <title>Qt 1.1: QVersitContactExporter Class Reference</title>
  <link rel="stylesheet" type="text/css" href="style/style.css"
 />  <!--[if IE]>
<meta name="MSSmartTagsPreventParsing" content="true">
<meta http-equiv="imagetoolbar" content="no">
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" type="text/css" href="style/style_ie6.css">
<![endif]-->
<!--[if IE 7]>
<link rel="stylesheet" type="text/css" href="style/style_ie7.css">
<![endif]-->
<!--[if IE 8]>
<link rel="stylesheet" type="text/css" href="style/style_ie8.css">
<![endif]-->
  <script src="scripts/jquery.js" type="text/javascript"></script>
  <script src="scripts/functions.js" type="text/javascript"></script>
 <script src="./scripts/superfish.js" type="text/javascript"></script>
 <script src="./scripts/narrow.js" type="text/javascript"></script>
  <link rel="stylesheet" type="text/css" href="style/superfish.css" />  <link rel="stylesheet" type="text/css" href="style/narrow.css" /></head>
<body class="" onload="CheckEmptyAndLoadList();">
 <div class="header" id="qtdocheader">
    <div id="nav-logo">
      <a href="index.html">Home</a></div>
    <a href="index.html" class="qtref"><span>Qt Mobility Reference Documentation</span></a>
    <div id="nav-topright">
      <ul>
        <li class="nav-topright-home"><a href="http://qt.nokia.com/">Qt HOME</a></li>
        <li class="nav-topright-dev"><a href="http://qt.nokia.com/developer">DEV</a></li>
        <li class="nav-topright-labs"><a href="http://labs.qt.nokia.com/blogs/">LABS</a></li>
        <li class="nav-topright-doc nav-topright-doc-active"><a href="http://doc.qt.nokia.com/">
          DOC</a></li>
        <li class="nav-topright-blog"><a href="http://blog.qt.nokia.com/">BLOG</a></li>
        <li class="nav-topright-shop"><a title="SHOP" href="http://shop.qt.nokia.com">SHOP</a></li>
      </ul>
    </div>
    <div id="shortCut">
      <ul>
        <li class="shortCut-topleft-inactive"><span><a href="index.html">Mobility 1.1</a></span></li>
        <li class="shortCut-topleft-active"><a href="http://qt.nokia.com/doc/">ALL Qt VERSIONS        </a></li>
      </ul>
    </div>
  </div>
  <div class="wrapper">
    <div class="hd">
      <span></span>
    </div>
    <div class="bd group">
      <div class="sidebar">
        <div class="searchlabel">
          Search index:</div>
        <div class="search">
          <form id="qtdocsearch" action="">
            <fieldset>
              <input type="text" name="searchstring" id="pageType" value="" />
            </fieldset>
          </form>
        </div>
        <div class="box first bottombar" id="lookup">
          <h2><span></span>
            API Lookup</h2>
          <div  id="list001" class="list">
          <ul id="ul001" >
              <li class="defaultLink"><a href="classes.html">Class index</a></li>
              <li class="defaultLink"><a href="functions.html">Function index</a></li>
              <li class="defaultLink"><a href="modules.html">Modules</a></li>
              <li class="defaultLink"><a href="namespaces.html">Namespaces</a></li>
              <li class="defaultLink"><a href="qtglobal.html">Global stuff</a></li>
              <li class="defaultLink"><a href="qdeclarativeelements.html">QML elements</a></li>
            </ul> 
          </div>
        </div>
        <div class="box bottombar" id="topics">
          <h2><span></span>
            Qt Topics</h2>
          <div id="list002" class="list">
            <ul id="ul002" >
              <li class="defaultLink"><a href="qt-basic-concepts.html">Basic Qt architecture</a></li>
              <li class="defaultLink"><a href="declarativeui.html">Device UI's &amp; Qt Quick</a></li>
              <li class="defaultLink"><a href="qt-gui-concepts.html">Desktop UI components</a></li>
              <li class="defaultLink"><a href="platform-specific.html">Platform-specific info</a></li>
            </ul>  
          </div>
        </div>
        <div class="box" id="examples">
          <h2><span></span>
            Examples</h2>
          <div id="list003" class="list">
        <ul id="ul003">
              <li class="defaultLink"><a href="all-examples.html">Examples</a></li>
              <li class="defaultLink"><a href="tutorials.html">Tutorials</a></li>
              <li class="defaultLink"><a href="demos.html">Demos</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html">QML Examples</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html#Demos">QML Demos</a></li>
            </ul> 
          </div>
        </div>
      </div>
      <div class="wrap">
        <div class="toolbar">
          <div class="breadcrumb toolblock">
            <ul>
              <li class="first"><a href="index.html">Home</a></li>
              <!--  Bread crumbs goes here -->
              <li><a href="modules.html">Modules</a></li>              <li>QVersitContactExporter</li>
            </ul>
          </div>
          <div class="toolbuttons toolblock">
            <ul>
              <li id="smallA" class="t_button">A</li>
              <li id="medA" class="t_button active">A</li>
              <li id="bigA" class="t_button">A</li>
              <li id="print" class="t_button"><a href="javascript:this.print();">
                <span>Print</span></a></li>
            </ul>
          </div>
        </div>
        <div class="content">
<div class="toc">
<h3>Contents</h3>
<ul>
<li class="level1"><a href="#public-types">Public Types</a></li>
<li class="level1"><a href="#public-functions">Public Functions</a></li>
<li class="level1"><a href="#details">Detailed Description</a></li>
<li class="level2"><a href="#exporting-group-relationships">Exporting group relationships</a></li>
</ul>
</div>
<h1 class="title">QVersitContactExporter Class Reference</h1>
<p>The QVersitContactExporter class converts <a href="qcontact.html">QContacts</a> into <a href="qversitdocument.html">QVersitDocuments</a>. <a href="#details">More...</a></p>
<pre class="highlightedCode brush: cpp"> #include &lt;QVersitContactExporter&gt;</pre><ul>
<li><a href="qversitcontactexporter-members.html">List of all members, including inherited members</a></li>
</ul>
<hr />
<a name="public-types"></a>
<h2>Public Types</h2>
<table class="alignedsummary">
<tr><td class="memItemLeft rightAlign topAlign"> enum </td><td class="memItemRight bottomAlign"><b><a href="qversitcontactexporter.html#Error-enum">Error</a></b> { NoError, EmptyContactError, NoNameError }</td></tr>
</table>
<hr />
<a name="public-functions"></a>
<h2>Public Functions</h2>
<table class="alignedsummary">
<tr><td class="memItemLeft rightAlign topAlign"> </td><td class="memItemRight bottomAlign"><b><a href="qversitcontactexporter.html#QVersitContactExporter">QVersitContactExporter</a></b> ()</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> </td><td class="memItemRight bottomAlign"><b><a href="qversitcontactexporter.html#dtor.QVersitContactExporter">~QVersitContactExporter</a></b> ()</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> QList&lt;QVersitDocument&gt; </td><td class="memItemRight bottomAlign"><b><a href="qversitcontactexporter.html#documents">documents</a></b> () const</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> QMap&lt;int, Error&gt; </td><td class="memItemRight bottomAlign"><b><a href="qversitcontactexporter.html#errors">errors</a></b> () const</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> bool </td><td class="memItemRight bottomAlign"><b><a href="qversitcontactexporter.html#exportContacts">exportContacts</a></b> ( const QList&lt;QContact&gt; &amp; <i>contacts</i>, QVersitDocument::VersitType <i>versitType</i> )</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> QVersitResourceHandler * </td><td class="memItemRight bottomAlign"><b><a href="qversitcontactexporter.html#resourceHandler">resourceHandler</a></b> () const</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> void </td><td class="memItemRight bottomAlign"><b><a href="qversitcontactexporter.html#setDetailHandler">setDetailHandler</a></b> ( QVersitContactExporterDetailHandlerV2 * <i>handler</i> )</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> void </td><td class="memItemRight bottomAlign"><b><a href="qversitcontactexporter.html#setResourceHandler">setResourceHandler</a></b> ( QVersitResourceHandler * <i>handler</i> )</td></tr>
</table>
<a name="details"></a>
<hr />
<div class="descr"/>
<h2>Detailed Description</h2>
<p>The QVersitContactExporter class converts <a href="qcontact.html">QContacts</a> into <a href="qversitdocument.html">QVersitDocuments</a>.</p>
<p>This class is used to convert lists of <a href="qcontact.html">QContacts</a> (which may be stored in a <a href="qcontactmanager.html">QContactManager</a>) into lists of <a href="qversitdocument.html">QVersitDocuments</a> (which may be written to an I/O device using <a href="qversitreader.html">QVersitReader</a>. Unless there is an error, there is a one-to-one mapping between contacts and Versit documents. The exporter can be extended by clients by associating resource and detail handlers.</p>
<p>A <a href="qversitresourcehandler.html">QVersitResourceHandler</a> is associated with the exporter to supply the behaviour for loading files from persistent storage. By default, this is set to a <a href="qversitdefaultresourcehandler.html">QVersitDefaultResourceHandler</a>, which supports basic resource loading from the file system. An alternative resource handler can be specified with <a href="qversitcontactexporter.html#setResourceHandler">setResourceHandler</a>().</p>
<p>By associating a <a href="qversitcontactexporterdetailhandlerv2.html">QVersitContactExporterDetailHandlerV2</a> with the exporter using <a href="qversitcontactexporter.html#setDetailHandler">setDetailHandler</a>(), the client can pass in a handler to override the processing of details and/or handle details that QVersitContactExporter doesn't support. A &quot;backup&quot; handler is provided by <a href="qversitcontactexporterdetailhandlerv2.html#createBackupHandler">QVersitContactExporterDetailHandlerV2::createBackupHandler</a>(), which serializes any details that the standard QVersitContactExporter doesn't support to the vCard.</p>
<p>An example usage of QVersitContactExporter:</p>
<pre class="highlightedCode brush: cpp">     QVersitContactExporter contactExporter;

     QVersitContactExporterDetailHandlerV2* backupHandler =
         QVersitContactExporterDetailHandlerV2::createBackupHandler();
     contactExporter.setDetailHandler(backupHandler);

     QContact contact;
     <span class="comment">// Create a name</span>
     QContactName name;
     name.setFirstName(QString::fromAscii(&quot;John&quot;));
     contact.saveDetail(&amp;name);

     if (!contactExporter.exportContacts(QList&lt;QContact&gt;() &lt;&lt; contact, QVersitDocument::VCard30Type))
         return;
     QList&lt;QVersitDocument&gt; versitDocuments = contactExporter.documents();

     <span class="comment">// detailHandler.mUnknownDetails now contains the list of unknown details</span>

     delete backupHandler;</pre>
<a name="exporting-group-relationships"></a>
<h3>Exporting group relationships</h3>
<p>The exporter does not handle QContactRelationships at all.</p>
<p>Some managers use the <a href="qcontactrelationship.html#HasMember-var">HasMember</a> <a href="qcontactrelationship.html">QContactRelationship</a> along with contacts of type TypeGroup to indicate categorization of contacts. In vCard, categorization is represented by the CATEGORIES property, which has semantics most similar to the QContactTag detail. For contact manager backends that supports groups but not QContactTag, if the categorization information needs to be retained through CATEGORIES vCard properties, extra work can be done to convert from group relationships to QContactTag before passing the contact list to the exporter. Below is some example code that does this translation.</p>
<pre class="highlightedCode brush: cpp"><span class="comment"> /*! Adds QContactTag details to the \a contacts, based on the \a relationships.

   Tags are created such that if a group contact, B with display label &quot;b&quot;, has a HasMember
   relationship with a contact, A, then a QContactTag, &quot;b&quot;, is added to A.

   Group contacts can be passed in with the \a contacts list.  If a contact is part of a group which
   is not in \a contacts, the \a manager is queried to find them.
   */</span>
 void createTagsFromGroups(QList&lt;QContact&gt;* contacts,
                           const QList&lt;QContactRelationship&gt;&amp; relationships,
                           const QContactManager* manager)
 {
     <span class="comment">// Map from QContactIds to group names</span>
     QMap&lt;QContactId, QString&gt; groupMap;

     <span class="comment">// Map from QContactIds to indices into the contacts list</span>
     QMap&lt;QContactId, int&gt; indexMap;
     <span class="comment">// Build up groupMap and indexMap</span>
     for (int i = 0; i &lt; contacts-&gt;size(); ++i) {
         QContact contact = contacts-&gt;at(i);
         if (contact.type() == QContactType::TypeGroup) {
             <span class="comment">// In practice, you may want to check that there aren't two distinct groups with the</span>
             <span class="comment">// same name, and you may want to use a field other than display label.</span>
             groupMap.insert(contact.id(), contact.displayLabel());
         }
         indexMap.insert(contact.id(), i);
     }

     <span class="comment">// Now add all the tags specified by the group relationships</span>
     foreach (const QContactRelationship&amp; rel, relationships) {
         if (rel.relationshipType() == QContactRelationship::HasMember
             &amp;&amp; indexMap.contains(rel.second())) {
             QString groupName = groupMap.value(rel.first()); <span class="comment">// Have we seen the group before?</span>
             if (groupName.isEmpty()) {
                 <span class="comment">// Try and find the group in the manager</span>
                 QContactId groupId = rel.second();
                 QContactFetchHint fetchHint;
                 fetchHint.setDetailDefinitionsHint(QStringList(QContactDisplayLabel::DefinitionName));
                 QContact contact = manager-&gt;contact(groupId.localId(), fetchHint);
                 if (!contact.isEmpty()) {
                     groupName = contact.displayLabel();
                     groupMap.insert(groupId, groupName); <span class="comment">// Cache the group id/name</span>
                 }
             }
             if (!groupName.isEmpty()) {
                 <span class="comment">// Add the tag</span>
                 QContactTag tag;
                 tag.setTag(groupName);
                 (*contacts)[indexMap.value(rel.second())].saveDetail(&amp;tag);
             }
         }
     }
 }</pre>
</div>
<p>See also <a href="qversitdocument.html">QVersitDocument</a>, <a href="qversitproperty.html">QVersitProperty</a>, <a href="qversitresourcehandler.html">QVersitResourceHandler</a>, and <a href="qversitcontactexporterdetailhandlerv2.html">QVersitContactExporterDetailHandlerV2</a>.</p>
<hr />
<div class="types"/>
<h2>Member Type Documentation</h2>
<h3 class="fn"><a name="Error-enum"></a>enum QVersitContactExporter::Error</h3>
<p>This enum specifies an error that occurred during the most recent call to <a href="qversitcontactexporter.html#exportContacts">exportContacts</a>()</p>
<table class="valuelist"><tr class="odd"><tr><th>Constant</th><th>Value</th><th>Description</th></tr>
<tr><td  class="topAlign"><tt>QVersitContactExporter::NoError</tt></td><td class=" topAlign"><tt>0</tt></td><td  class="topAlign">The most recent operation was successful</td></tr>
<tr><td  class="topAlign"><tt>QVersitContactExporter::EmptyContactError</tt></td><td class=" topAlign"><tt>1</tt></td><td  class="topAlign">One of the contacts was empty</td></tr>
<tr><td  class="topAlign"><tt>QVersitContactExporter::NoNameError</tt></td><td class=" topAlign"><tt>2</tt></td><td  class="topAlign">One of the contacts has no QContactName field</td></tr>
</table>
</div>
<hr />
<div class="func"/>
<h2>Member Function Documentation</h2>
<h3 class="fn"><a name="QVersitContactExporter"></a>QVersitContactExporter::QVersitContactExporter ()</h3>
<p>Constructs a new contact exporter</p>
<h3 class="fn"><a name="dtor.QVersitContactExporter"></a>QVersitContactExporter::~QVersitContactExporter ()</h3>
<p>Frees any memory in use by this contact exporter.</p>
<h3 class="fn"><a name="documents"></a>QList&lt;<a href="qversitdocument.html">QVersitDocument</a>&gt; QVersitContactExporter::documents () const</h3>
<p>Returns the documents exported in the most recent call to <a href="qversitcontactexporter.html#exportContacts">exportContacts</a>().</p>
<p>See also <a href="qversitcontactexporter.html#exportContacts">exportContacts</a>().</p>
<h3 class="fn"><a name="errors"></a>QMap&lt;int, <a href="qversitcontactexporter.html#Error-enum">Error</a>&gt; QVersitContactExporter::errors () const</h3>
<p>Returns the map of errors encountered in the most recent call to <a href="qversitcontactexporter.html#exportContacts">exportContacts</a>(). The key is the index into the input list of contacts and the value is the error that occurred on that contact.</p>
<p>See also <a href="qversitcontactexporter.html#exportContacts">exportContacts</a>().</p>
<h3 class="fn"><a name="exportContacts"></a>bool QVersitContactExporter::exportContacts ( const QList&lt;<a href="qcontact.html">QContact</a>&gt; &amp; <i>contacts</i>, <a href="qversitdocument.html#VersitType-enum">QVersitDocument::VersitType</a> <i>versitType</i> )</h3>
<p>Converts <i>contacts</i> into a list of corresponding QVersitDocuments, using the format given by <i>versitType</i>. Returns true on success. If any of the contacts could not be exported, false is returned and <a href="qversitcontactexporter.html#errors">errors</a>() will return a list describing the errors that occurred. The successfully exported documents will still be available via <a href="qversitcontactexporter.html#documents">documents</a>().</p>
<h3 class="fn"><a name="resourceHandler"></a><a href="qversitresourcehandler.html">QVersitResourceHandler</a> * QVersitContactExporter::resourceHandler () const</h3>
<p>Returns the associated resource handler.</p>
<p>See also <a href="qversitcontactexporter.html#setResourceHandler">setResourceHandler</a>().</p>
<h3 class="fn"><a name="setDetailHandler"></a>void QVersitContactExporter::setDetailHandler ( <a href="qversitcontactexporterdetailhandlerv2.html">QVersitContactExporterDetailHandlerV2</a> * <i>handler</i> )</h3>
<p>Sets <i>handler</i> to be the handler for processing QContactDetails, or 0 to have no handler.</p>
<p>Does not take ownership of the handler. The client should ensure the handler remains valid for the lifetime of the exporter. This function is used for version 2 and higher handlers.</p>
<p>Only one detail handler can be set. If another detail handler (of any version) was previously set, it will no longer be associated with the exporter.</p>
<h3 class="fn"><a name="setResourceHandler"></a>void QVersitContactExporter::setResourceHandler ( <a href="qversitresourcehandler.html">QVersitResourceHandler</a> * <i>handler</i> )</h3>
<p>Sets <i>handler</i> to be the handler to load files with, or 0 to have no handler.</p>
<p>Does not take ownership of the handler. The client should ensure the handler remains valid for the lifetime of the exporter.</p>
<p>See also <a href="qversitcontactexporter.html#resourceHandler">resourceHandler</a>().</p>
</div>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td align="left">Copyright &copy; 2009-2010 Nokia Corporation and/or its subsidiary(-ies)</td>
<td width="20%" align="center"><a href="trademarks.html">Trademarks</a></td>
<td align="right"><div align="right">Qt Mobility Project 1.1.0</div></td>
</tr></table></div></address>  <script src="scripts/functions.js" type="text/javascript"></script>
</body>
</html>

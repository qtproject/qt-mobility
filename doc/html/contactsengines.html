<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<!-- contactsengines.qdoc -->
<head>
  <title>Qt Mobility Project 1.0: Qt Contacts Manager Engines</title>
<meta http-equiv="Content-type" content="text/html; charset=ISO-8859-1" />  <link href="classic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32"><a href="http://qt.nokia.com/"><img src="images/qtlogo.png" align="left" border="0" /></a></td>
<td width="1">&nbsp;&nbsp;</td><td class="postheader" valign="center"><a href="index.html"><font color="#004faf">Home</font></a>&nbsp;&middot; <a href="classes.html"><font color="#004faf">All&nbsp;Classes</font></a>&nbsp;&middot; <a href="functions.html"><font color="#004faf">All&nbsp;Functions</font></a>&nbsp;&middot;</td>
<td align="right" valign="top" width="230"><img src="images/codeless.png"  border="0" /></td></tr></table><h1 class="title">Qt Contacts Manager Engines<br /><span class="subtitle"></span>
</h1>
<ul><li><a href="#introduction">Introduction</a></li>
<li><a href="#information-for-clients">Information For Clients</a></li>
<ul><li><a href="#where-is-the-data-stored">Where Is The Data Stored?</a></li>
<li><a href="#schema-differences">Schema Differences</a></li>
<li><a href="#provided-engines">Provided Engines</a></li>
<ul><li><a href="#in-memory-example-engine">In-Memory Example Engine</a></li>
<li><a href="#symbian-3-1-engine">Symbian 3.1 Engine</a></li>
<li><a href="#symbian-3-2-engine">Symbian 3.2 Engine</a></li>
<li><a href="#symbian-5-0-engine">Symbian 5.0 Engine</a></li>
<li><a href="#maemo-5-(fremantle- engine">Maemo 5 (Fremantle) Engine</a></li>
<li><a href="#libqttracker-engine">libQtTracker Engine</a></li>
</ul>
</ul>
<li><a href="#information-for-engine-implementors">Information For Engine Implementors</a></li>
<ul><li><a href="#which-functions-do-i-need-to-implement">Which Functions Do I Need To Implement</a></li>
<ul><li><a href="#mandatory-functions">Mandatory Functions</a></li>
<li><a href="#optional-functionality">Optional Functionality</a></li>
<li><a href="#optional-implementation">Optional Implementation</a></li>
</ul>
<li><a href="#which-signals-do-i-need-to-emit">Which Signals Do I Need To Emit</a></li>
<li><a href="#other-considerations">Other Considerations</a></li>
<li><a href="#example-implementation">Example Implementation</a></li>
</ul>
</ul>
<a name="introduction"></a>
<h2>Introduction</h2>
<p>The <a href="qcontactmanager.html">QContactManager</a> interface provided to clients to allow access to contact information depends on an implementation of <a href="qcontactmanagerengine.html">QContactManagerEngine</a> existing. This engine provides the methods which are called by the manager. An engine is identified by its URI, which is the name reported to clients through the <a href="qcontactmanager.html#managerUri">QContactManager::managerUri</a>() function. The URI of a manager is built by combining its name, version and relevant construction parameters.</p>
<a name="information-for-clients"></a>
<h2>Information For Clients</h2>
<p>While clients never interact directly with instances of <a href="qcontactmanagerengine.html">QContactManagerEngine</a>, they may need to be aware of limitations of individual engines, or differences between engines. The API offered through <a href="qcontactmanager.html">QContactManager</a> allows clients to retrieve this information for the engine which provides the functionality exposed through a particular <a href="qcontactmanager.html">QContactManager</a>.</p>
<a name="where-is-the-data-stored"></a>
<h3>Where Is The Data Stored?</h3>
<p>A <a href="qcontactmanagerengine.html">QContactManagerEngine</a> may provide an aggregated view of multiple physical datastores, zero or more of which may be remote datastores. Clients of the API are aware only that the data is managed by a <a href="qcontactmanagerengine.html">QContactManagerEngine</a> with a particular URI. It is possible that multiple different engines will have overlap in the datastores which they aggregate, and in that case the way in which those engines were implemented will determine whether operations are thread-safe or not.</p>
<p>Since the data may physically be stored in a remote datastore, any operations may be dominated by the return-trip-time of communications with the remote datastore. As such, it is recommended that clients use the asynchronous client API to access contact information from any <a href="qcontactmanager.html">QContactManager</a>.</p>
<a name="schema-differences"></a>
<h3>Schema Differences</h3>
<p>Each engine may support a different schema. All engines should attempt to support the default schema, described in the <a href="contactsschema.html">default schema</a> documentation, however clients should never assume that any engine does support the default schema fully.</p>
<p>Clients are able to retrieve the schema supported by a particular engine at run-time by calling <a href="qcontactmanager.html#detailDefinitions">QContactManager::detailDefinitions</a>(). Some engines support different detail definitions (that is, a different schema) for different types of contacts. Clients can retrieve the contact types supported by an engine by calling <a href="qcontactmanager.html#supportedContactTypes">QContactManager::supportedContactTypes</a>().</p>
<a name="provided-engines"></a>
<h3>Provided Engines</h3>
<p>The Contacts module of the Qt Mobility project includes several backends already, some of which are designed to interface with the default addressbook on their particular platform.</p>
<a name="in-memory-example-engine"></a>
<h4>In-Memory Example Engine</h4>
<p>The in-memory engine identifies itself as the &quot;memory&quot; engine. It is available on all platforms which are supported by the Qt Mobility project.</p>
<p>The in-memory engine supports the default schema, and provides all functionality available through the Qt Mobility Contacts API; however, all data is stored in-memory and is not persisted in any way.</p>
<a name="symbian-3-1-engine"></a>
<h4>Symbian 3.1 Engine</h4>
<p>The Symbian 3.1 engine identifies itself as the &quot;symbian&quot; engine, but is only available on the Symbian 3.1 platform.</p>
<p>The Symbian 3.1 engine supports a modified version of the default schema.</p>
<ul>
<li>TODO: what is the schema supported by this engine.</li>
<li>TODO: what functionality is supported by this engine.</li>
<li>TODO: is there anything else that clients may need to know?</li>
</ul>
<a name="symbian-3-2-engine"></a>
<h4>Symbian 3.2 Engine</h4>
<p>The Symbian 3.2 engine identifies itself as the &quot;symbian&quot; engine, but is only available on the Symbian 3.2 platform.</p>
<p>The Symbian 3.2 engine supports a modified version of the default schema.</p>
<ul>
<li>TODO: what is the schema supported by this engine.</li>
<li>TODO: what functionality is supported by this engine.</li>
<li>TODO: is there anything else that clients may need to know?</li>
</ul>
<a name="symbian-5-0-engine"></a>
<h4>Symbian 5.0 Engine</h4>
<p>The Symbian 5.0 engine identifies itself as the &quot;symbian&quot; engine, but is only available on the Symbian 5.0 platform.</p>
<p>The Symbian 5.0 engine supports a modified version of the default schema.</p>
<ul>
<li>TODO: what is the schema supported by this engine.</li>
<li>TODO: what functionality is supported by this engine.</li>
<li>TODO: is there anything else that clients may need to know?</li>
</ul>
<a name="maemo-5-(fremantle- engine"></a>
<h4>Maemo 5 (Fremantle) Engine</h4>
<p>The Maemo 5 (Fremantle) engine identifies itself as the &quot;maemo5&quot; engine, but is only available on the Maemo 5 (Fremantle) platform which has the correct libraries installed (including lib-osso-abook).</p>
<p>The Maemo 5 (Fremantle) engine supports a modified version of the default schema. In particular, it does not support the following details which are provided in the default schema:</p>
<ul>
<li><a href="qcontactanniversary.html">QContactAnniversary</a></li>
<li><a href="qcontactavatar.html">QContactAvatar</a> (it does, however, support <a href="qcontactthumbnail.html">QContactThumbnail</a> details)</li>
<li><a href="qcontactgeolocation.html">QContactGeoLocation</a></li>
<li><a href="qcontactglobalpresence.html">QContactGlobalPresence</a></li>
<li><a href="qcontactpresence.html">QContactPresence</a></li>
<li><a href="qcontactringtone.html">QContactRingtone</a></li>
<li><a href="qcontactsynctarget.html">QContactSyncTarget</a></li>
<li><a href="qcontacttag.html">QContactTag</a></li>
</ul>
<p>Furthermore, it supports only a subset of the fields and values supported by the default schema versions of various details. The limitations are as follows:</p>
<ul>
<li>It does not support the <tt>QContactDetail::Context</tt> field for any details other than <a href="qcontactphonenumber.html">QContactPhoneNumber</a>, <a href="qcontactemailaddress.html">QContactEmailAddress</a> and <a href="qcontactaddress.html">QContactAddress</a> details, and only supports the contexts <tt>QContactDetail::ContextHome</tt> and <tt>QContactDetail::ContextWork</tt></li>
<li>It does not support the <tt>QContactAddress::FieldSubTypes</tt> field of <a href="qcontactaddress.html">QContactAddress</a> details</li>
<li>It does not support the <tt>QContactName::FieldCustomLabel</tt>, <tt>QContactName::FieldSuffix</tt>, <tt>QContactName::FieldPrefix</tt> or <tt>QContactName::FieldMiddleName</tt> fields of <a href="qcontactname.html">QContactName</a> details</li>
<li>It does not support the <tt>QContactOnlineAccount::FieldSubTypes</tt> field of <a href="qcontactonlineaccount.html">QContactOnlineAccount</a> details</li>
<li>It does not support the <tt>QContactUrl::FieldSubTypes</tt> field of <a href="qcontacturl.html">QContactUrl</a> details</li>
<li>It supports only the <tt>QContactOrganization::DisplayLabel</tt> field of <a href="qcontactorganization.html">QContactOrganization</a> details</li>
<li>It supports only the <tt>QContactPhoneNumber::SubTypeMobile</tt> and <tt>QContactPhoneNumber::SubTypeVoice</tt> values for the <tt>QContactPhoneNumber::FieldSubTypes</tt> field of <a href="qcontactphonenumber.html">QContactPhoneNumber</a> details</li>
</ul>
<p>The Maemo 5 (Fremantle) engine supports asynchronous and synchronous requests, but does not support group contacts or relationships of any kind. It does not allow clients to set a particular contact as the &quot;self&quot; contact. It persists all data in the system addressbook.</p>
<a name="libqttracker-engine"></a>
<h4>libQtTracker Engine</h4>
<p>The libQtTracker Engine identifies itself as &quot;qtcontacts-tracker&quot;, and is available on any platform which supports the required libqttracker libraries of the correct version.</p>
<p>The libQtTracker engine supports a modified version of the default schema.</p>
<ul>
<li>TODO: what is the schema supported by this engine.</li>
<li>TODO: what functionality is supported by this engine.</li>
<li>TODO: is there anything else that clients may need to know?</li>
</ul>
<a name="information-for-engine-implementors"></a>
<h2>Information For Engine Implementors</h2>
<p>Some developers may wish to provide implementations of <a href="qcontactmanagerengine.html">QContactManagerEngine</a> for use by clients. The engine that they provide may aggregate multiple datastores, or access a remote datastore, or provide some other functionality to clients. An engine is distributed as a Qt Plugin, and will be detected automatically by the plugin loading code in the <a href="qcontactmanager.html">QContactManager</a>, so long as the plugin is located in the correct path ($QT_PLUGINS_DIR/contacts/).</p>
<a name="which-functions-do-i-need-to-implement"></a>
<h3>Which Functions Do I Need To Implement</h3>
<p>Different engines provide different functionality and support different features. Depending on the feature set of the engine, it will need to implement a particular subset of the API. The default implementation for most functions will set the error to <tt>QContactManager::NotSupportedError</tt> and return the value which indicates that an error has occurred.</p>
<a name="mandatory-functions"></a>
<h4>Mandatory Functions</h4>
<p>All engines must implement the following functions:</p>
<ul>
<li><a href="qcontactmanagerengine.html#managerName">QContactManagerEngine::managerName</a>()</li>
<li><a href="qcontactmanagerengine.html#managerVersion">QContactManagerEngine::managerVersion</a>()</li>
<li><a href="qcontactmanagerengine.html#supportedContactTypes">QContactManagerEngine::supportedContactTypes</a>()</li>
<li><a href="qcontactmanagerengine.html#supportedDataTypes">QContactManagerEngine::supportedDataTypes</a>()</li>
<li><a href="qcontactmanagerengine.html#hasFeature">QContactManagerEngine::hasFeature</a>()</li>
<li><a href="qcontactmanagerengine.html#detailDefinitions">QContactManagerEngine::detailDefinitions</a>()</li>
<li><a href="qcontactmanagerengine.html#contactIds">QContactManagerEngine::contactIds</a>()</li>
<li><a href="qcontactmanagerengine.html#contacts">QContactManagerEngine::contacts</a>()</li>
</ul>
<p>Every engine implementation must also come with an implementation of <a href="qcontactmanagerenginefactory.html">QContactManagerEngineFactory</a> for that engine.</p>
<p>Note that you do not need to implement filtering and sorting natively in an engine; the default implementation offers the following static functions to perform filtering and sorting respectively, in memory:</p>
<ul>
<li><a href="qcontactmanagerengine.html#testFilter">QContactManagerEngine::testFilter</a>()</li>
<li><a href="qcontactmanagerengine.html#sortContacts">QContactManagerEngine::sortContacts</a>()</li>
</ul>
<p>However, engine implementors should be aware that the default implementation is naive and will have greatly reduced performance compared to a native implementation (e.g&#x2e;, SQL queries, if the contact data exposed by the engine implementation is stored in an SQL database).</p>
<p>Similarly, any <a href="qcontactfetchhint.html">QContactFetchHint</a> parameter may be ignored by an engine implementation, but if it does so it must return all information available for the contact.</p>
<p>All engines must also implement the following functions to implement asynchronous requests:</p>
<ul>
<li><a href="qcontactmanagerengine.html#requestDestroyed">QContactManagerEngine::requestDestroyed</a>()</li>
<li><a href="qcontactmanagerengine.html#startRequest">QContactManagerEngine::startRequest</a>()</li>
<li><a href="qcontactmanagerengine.html#cancelRequest">QContactManagerEngine::cancelRequest</a>()</li>
<li><a href="qcontactmanagerengine.html#waitForRequestFinished">QContactManagerEngine::waitForRequestFinished</a>()</li>
</ul>
<p>If the engine does not support asynchronous requests, it should always return false in the last three of those functions, and do nothing in the first. If the engine does support asynchronous requests, it must ensure that all information required to perform the request is saved in the engine within <a href="qcontactmanagerengine.html#startRequest">QContactManagerEngine::startRequest</a>(), as the client owns the request object and may delete it at any time. In general, engine implementors should be aware of this ownership semantic, and never attempt an unsafe operation on a request pointer.</p>
<p>It is recommended that all engine implementations support asynchronous requests, even if they use a &quot;dummy&quot; implementation which services the request synchronously during startRequest, and then emit the appropriate signals from the request via a zero-millisecond timeout timer.</p>
<a name="optional-functionality"></a>
<h4>Optional Functionality</h4>
<p>The rest of the virtual functions are optional, and should be implemented only if the engine supports the operations.</p>
<p>If the engine can be constructed with different parameters, which affects the operation of the engine (for example, a parameter might define which file to read contact information from, or it might be an access token to prove that the client has the access rights to read contact information from the engine, etc), it must report which parameters it was constructed with via the</p>
<ul>
<li><a href="qcontactmanagerengine.html#managerParameters">QContactManagerEngine::managerParameters</a>()</li>
</ul>
<p>function.</p>
<p>If the engine supports native filtering of any kind, it must report to clients which filters are supported natively by implementing:</p>
<ul>
<li><a href="qcontactmanagerengine.html#isFilterSupported">QContactManagerEngine::isFilterSupported</a>()</li>
</ul>
<p>If the engine supports saving or removing contact information, as well as retrieval, it must implement:</p>
<ul>
<li><a href="qcontactmanagerengine.html#saveContacts">QContactManagerEngine::saveContacts</a>()</li>
<li><a href="qcontactmanagerengine.html#removeContacts">QContactManagerEngine::removeContacts</a>()</li>
</ul>
<p>It may also choose to implement the &quot;single contact&quot; functions:</p>
<ul>
<li><a href="qcontactmanagerengine.html#saveContact">QContactManagerEngine::saveContact</a>()</li>
<li><a href="qcontactmanagerengine.html#removeContact">QContactManagerEngine::removeContact</a>()</li>
</ul>
<p>If it does not, the default implementation of those functions will use the batch (plural) versions of those functions to implement the required behaviour.</p>
<p>If the engine supports modification of its schema (that is, extension of its definitions at run-time), it must report that it supports the <tt>QContactManager::MutableDefinitions</tt> feature via <a href="qcontactmanagerengine.html#hasFeature">QContactManagerEngine::hasFeature</a>(), and must also implement:</p>
<ul>
<li><a href="qcontactmanagerengine.html#saveDetailDefinition">QContactManagerEngine::saveDetailDefinition</a>()</li>
<li><a href="qcontactmanagerengine.html#removeDetailDefinition">QContactManagerEngine::removeDetailDefinition</a>()</li>
</ul>
<p>If the engine supports any relationships, it must report that it supports the <tt>QContactManager::Relationships</tt> feature via <a href="qcontactmanagerengine.html#hasFeature">QContactManagerEngine::hasFeature</a>(), and must also implement:</p>
<ul>
<li><a href="qcontactmanagerengine.html#isRelationshipTypeSupported">QContactManagerEngine::isRelationshipTypeSupported</a>()</li>
<li><a href="qcontactmanagerengine.html#relationships">QContactManagerEngine::relationships</a>()</li>
<li><a href="qcontactmanagerengine.html#saveRelationships">QContactManagerEngine::saveRelationships</a>()</li>
<li><a href="qcontactmanagerengine.html#removeRelationships">QContactManagerEngine::removeRelationships</a>()</li>
</ul>
<p>Specifically, if the engine supports group contacts, it must support the <tt>QContactRelationship::HasMember</tt> relationship, and report this as a supported relationship type. It must then also report that it supports the <tt>QContactType::TypeGroup</tt> contact type as a supported contact type in <a href="qcontactmanagerengine.html#supportedContactTypes">QContactManagerEngine::supportedContactTypes</a>().</p>
<p>If the engine supports saving a &quot;self&quot; contact (that is, a contact which contains information about the owner of the device or online service account from which the engine provides contact information), it must report that it supports the <tt>QContactManager::SelfContact</tt> feature via <a href="qcontactmanagerengine.html#hasFeature">QContactManagerEngine::hasFeature</a>(), and must also implement:</p>
<ul>
<li><a href="qcontactmanagerengine.html#setSelfContactId">QContactManagerEngine::setSelfContactId</a>()</li>
<li><a href="qcontactmanagerengine.html#selfContactId">QContactManagerEngine::selfContactId</a>()</li>
</ul>
<a name="optional-implementation"></a>
<h4>Optional Implementation</h4>
<p>Apart from areas of functionality which may be optionally implemented by the engine or not, the default implementation provides several functions which operate in a naive, in-memory manner. An engine implementation can override this default implementation with its own, if it wishes, in order to obtain performance gains, or to more accurately implement the function.</p>
<p>As previously mentioned it may implement its own sorting or filtering, in functions such as <a href="qcontactmanagerengine.html#contacts">QContactManagerEngine::contacts</a>(). An engine may also implement:</p>
<ul>
<li><a href="qcontactmanagerengine.html#validateContact">QContactManagerEngine::validateContact</a>()</li>
<li><a href="qcontactmanagerengine.html#validateDefinition">QContactManagerEngine::validateDefinition</a>()</li>
<li><a href="qcontactmanagerengine.html#compatibleContact">QContactManagerEngine::compatibleContact</a>()</li>
<li><a href="qcontactmanagerengine.html#synthesizedDisplayLabel">QContactManagerEngine::synthesizedDisplayLabel</a>()</li>
</ul>
<a name="which-signals-do-i-need-to-emit"></a>
<h3>Which Signals Do I Need To Emit</h3>
<p>An engine implementation must emit the appropriate signals for the subset of functionality that it supports.</p>
<p>If the engine supports reading or saving contacts, it must emit the:</p>
<ul>
<li><a href="qcontactmanagerengine.html#contactsAdded">QContactManagerEngine::contactsAdded</a>()</li>
<li><a href="qcontactmanagerengine.html#contactsChanged">QContactManagerEngine::contactsChanged</a>()</li>
<li><a href="qcontactmanagerengine.html#contactsRemoved">QContactManagerEngine::contactsRemoved</a>()</li>
</ul>
<p>signals as appropriate. Alternatively, it can emit the <a href="qcontactmanager.html#dataChanged">QContactManager::dataChanged</a>() signal instead.</p>
<p>If the engine supports reading or saving relationships, it must emit the:</p>
<ul>
<li><a href="qcontactmanagerengine.html#relationshipsAdded">QContactManagerEngine::relationshipsAdded</a>()</li>
<li><a href="qcontactmanagerengine.html#relationshipsRemoved">QContactManagerEngine::relationshipsRemoved</a>()</li>
</ul>
<p>signals as appropriate. Alternatively, it can emit the <a href="qcontactmanager.html#dataChanged">QContactManager::dataChanged</a>() signal instead.</p>
<p>If the engine supports the <tt>QContactManager::SelfContact</tt> feature, it must emit the:</p>
<ul>
<li><a href="qcontactmanagerengine.html#selfContactIdChanged">QContactManagerEngine::selfContactIdChanged</a>()</li>
</ul>
<p>signal as appropriate. Alternatively, it can emit the <a href="qcontactmanager.html#dataChanged">QContactManager::dataChanged</a>() signal instead.</p>
<a name="other-considerations"></a>
<h3>Other Considerations</h3>
<p>There are several other considerations that engine writers must be aware of:</p>
<ul>
<li>Most batch functions take an OPTIONAL error map as a parameter. This parameter may be null, in which case the client is not interested in fine-grained error reporting. Engines must check the pointer before attempting to dereference it.</li>
<li>Every function takes a mandatory <tt>QContactManager::Error</tt> pointer argument. This argument is NEVER null, since it exists in the private implementation of <a href="qcontactmanager.html">QContactManager</a>. Testing this argument for null is, therefore, superfluous.</li>
<li>The single-item functions for contact and relationship retrieval, removal and save already have a default implementation which merely wraps the batch retrieval, removal or save function appropriately. This default implementation may not be as performant as a hand-rolled function. Engine implementations MUST implement the batch functions for each area of functionality supported by the engine.</li>
<li>Most clients will prefer to use the asynchronous API to access contact information from the engine. It is therefore suggested that asynchronous requests be serviced, even if it is implemented in a similar manner to the (provided) memory engine's naive implementation.</li>
</ul>
<a name="example-implementation"></a>
<h3>Example Implementation</h3>
<p>There are several implementations of <a href="qcontactmanagerengine.html">QContactManagerEngine</a> available in the Qt Mobility source code repository. In particular, the &quot;memory&quot; engine provides an implementation of an in-memory, anonymous datastore which supports every feature in the API, and therefore is useful for demonstration purposes. Be aware, however, that the implementation of all functionality in the &quot;memory&quot; engine is naive and not performant, and should not be copied in any real engine implementation (e.g&#x2e;, to perform filtering, it reads all contacts from the (in-memory) database, and checks one by one for matches; a real engine, on the other hand, might perform a database query to return the results directly, rather than performing n-reads).</p>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td align="left">Copyright &copy; 2009 Nokia Corporation and/or its subsidiary(-ies)</td>
<td width="20%" align="center"><a href="trademarks.html">Trademarks</a></td>
<td align="right"><div align="right">Qt Mobility Project 1.0.0</div></td>
</tr></table></div></address></body>
</html>
